function ac_show_ajax_message(n,e){var i=jQuery('<div class="ac-message hidden '+e+'"><p>'+n+"</p></div>");jQuery(".ac-boxes").before(i),i.slideDown()}function cpac_submit_form(n){var e=n(".sidebox a.submit, .column-footer a.submit");e.click(function(){var i=n(this),t=i.closest(".ac-admin").addClass("saving"),c=t.find(".ac-columns form").serialize();e.attr("disabled","disabled"),t.find(".ac-message").remove();var a=n.post(ajaxurl,{plugin_id:"cpac",action:"cpac_columns_save",data:c,_ajax_nonce:AC._ajax_nonce,list_screen:AC.list_screen,layout:AC.layout},function(n){n&&(n.success?(ac_show_ajax_message(n.data,"updated"),t.addClass("stored")):n.data&&ac_show_ajax_message(n.data.message,"notice notice-warning"))},"json");a.fail(function(n){}),a.always(function(){e.removeAttr("disabled","disabled"),t.removeClass("saving")}),n(document).trigger("cac_update",t)})}function cpac_add_column(n){n(".add_column").click(function(e){e.preventDefault();var i=n("#add-new-column-template").find(".ac-column").clone();i.cpac_update_clone_id(),i.addClass("opened").find(".ac-column-body").slideDown(150,function(){n("html, body").animate({scrollTop:i.offset().top-58},300)}),n(".ac-columns form").append(i),i.column_bind_toggle(),i.column_bind_remove(),i.column_bind_clone(),i.column_bind_events(),n(document).trigger("column_add",i)})}function cpac_sidebar_feedback(n){var e=n(".sidebox#direct-feedback");e.find("#feedback-choice a.no").click(function(n){n.preventDefault(),e.find("#feedback-choice").slideUp(),e.find("#feedback-support").slideDown()}),e.find("#feedback-choice a.yes").click(function(n){n.preventDefault(),e.find("#feedback-choice").slideUp(),e.find("#feedback-rate").slideDown()})}function cpac_init(n){var e=n(".ac-admin"),i=e.find(".ac-boxes");if(i.hasClass("disabled"))i.find(".ac-column").each(function(e,i){n(i).column_bind_toggle(),n(i).find("input, select").prop("disabled",!0)});else{var t=i.find(".ac-columns");t.find(".ac-column").each(function(e,i){n(i).column_bind_toggle(),n(i).column_bind_remove(),n(i).column_bind_clone(),n(i).cpac_bind_indicator_events()}),t.cpac_bind_ordering()}n(document).trigger("cac_menu_change",t),n(document).trigger("cac_model_ready",e.data("type"))}function cpac_menu(n){n("#ac_list_screen").on("change",function(){n(".view-link").hide(),n(this).parents("form").submit(),n(this).prop("disabled",!0).next(".spinner").css("display","inline-block")})}function cpac_reset_columns(n){var e=n(".ac-admin");n("a[data-clear-columns]").on("click",function(){e.find(".ac-column").each(function(){n(this).find(".remove-button").trigger("click")})})}var AC,incremental_column_name=0;jQuery(document).ready(function(n){return 0!==n("#cpac").length&&(cpac_init(n),cpac_submit_form(n),cpac_reset_columns(n),cpac_menu(n),cpac_add_column(n),void cpac_sidebar_feedback(n))}),function(n){n.fn.column_bind_toggle=function(){var e=n(this),i=e.closest(".ac-boxes").hasClass("disabled");e.find('[data-toggle="column"]').click(function(t){t.preventDefault(),e.toggleClass("opened").find(".ac-column-body").slideToggle(150),i||(e.hasClass("events-binded")||e.column_bind_events(),e.addClass("events-binded"),n(document).trigger("column_init",n.column))}).css("cursor","pointer")},n.fn.column_bind_remove=function(){n(this).find(".remove-button").click(function(e){n(this).closest(".ac-column").column_remove(),e.preventDefault()})},n.fn.column_bind_clone=function(){n(this).find(".clone-button").click(function(e){e.preventDefault();var i=n(this).closest(".ac-column").column_clone();"undefined"!=typeof i&&i.removeClass("loading").hide().slideDown()})},n.fn.cpac_column_refresh=function(){var e=n(this),i=e.find('[data-refresh="column"]'),t=n(this).attr("data-column-name");n(document).trigger("pre_column_refresh",e);var c=n(this).find(":input").serializeArray(),a={plugin_id:"cpac",action:"cpac_column_refresh",_ajax_nonce:AC._ajax_nonce,list_screen:AC.list_screen,layout:AC.layout,column_name:t};n.each(a,function(n,e){c.push({name:n,value:e})}),e.addClass("loading"),i.prop("disabled",1);var o=n.post(ajaxurl,c,function(i){if(i){var t=n("<div>"+i.data+"</div>").children();e.replaceWith(t),e=t,e.column_bind_toggle(),e.column_bind_remove(),e.column_bind_clone(),e.column_bind_events(),e.addClass("opened").find(".ac-column-body").show(),n(document).trigger("column_change",e)}},"json");o.fail(function(n){var i=e.closest(".ac-admin").find(".ajax-message");i.addClass("error").find("p").html(AC.i18n.error),i.slideDown(),e.slideUp(function(){e.remove()}),console.log("responseText: "+n.responseText)}),o.always(function(){e.removeClass("loading"),i.prop("disabled",!1)})},n.fn.column_bind_events=function(){var e=n(this),i=e.closest(".ac-admin "),t=e.find("select.ac-setting-input_type option:selected").val();e.find("select.ac-setting-input_type").change(function(){var c=n("optgroup",this).children(":selected"),a=c.val(),o=n(this).next(".msg").hide(),l=n(this),d=[];i.find(".ac-column[data-original=1]").each(function(){d.push(n(this).data("type"))}),e.addClass("loading"),n.ajax({url:ajaxurl,method:"post",dataType:"json",data:{plugin_id:"cpac",action:"cpac_column_select",original_columns:d,_ajax_nonce:AC._ajax_nonce,type:a,list_screen:AC.list_screen,layout:AC.layout}}).done(function(i){if(i)if(i.success){var c=e.closest(".ac-column"),a=n("<div>"+i.data+"</div>").children();c.replaceWith(a),c=a,c.column_bind_toggle(),c.column_bind_remove(),c.column_bind_clone(),c.column_bind_events(),c.addClass("opened").find(".ac-column-body").show(),c.cpac_update_clone_id(),n(document).trigger("column_change",c)}else i.data&&"message"===i.data.type&&(o.html(i.data.error).show(),l.find("option").removeAttr("selected"),l.find('option[value="'+t+'"]').attr("selected","selected"))}).always(function(){e.removeClass("loading")})}),e.find(".ac-column-setting--label input").bind("keyup change",function(){var e=n(this).val();n(this).closest(".ac-column").find("td.column_label .inner > a.toggle").html(e)}),e.find(".ac-column-body .col-label .label").hover(function(){n(this).parents(".col-label").find("div.tooltip").show()},function(){n(this).parents(".col-label").find("div.tooltip").hide()}),e.find('[data-refresh="column"]').change(function(){e.cpac_column_refresh()}),n(document).trigger("init_settings",e)},n.fn.column_bind_settings=function(){var e=n(this);e.find(".ac-column-setting--image_size").cpac_column_setting_image_size(),e.find(".ac-column-setting--width").cpac_column_setting_width()},n.fn.column_remove=function(){n(this).addClass("deleting").animate({opacity:0,height:0},350,function(){n(this).remove()})},n.fn.column_clone=function(){var e=n(this),i=n(this).closest("ac-columns");if("1"===e.attr("data-original")){var t=AC.i18n.clone.replace("%s","<strong>"+e.find(".column_label .toggle").text()+"</strong>");return e.addClass("opened").find(".ac-column-body").slideDown(150),void e.find(".ac-setting-input_type").next(".msg").html(t).show()}var c=n(this).clone();return c.cpac_update_clone_id(),n(this).after(c),c.column_bind_toggle(),c.column_bind_remove(),c.column_bind_clone(),c.column_bind_events(),i.cpac_bind_ordering(),n(document).trigger("column_add",c),c},n.fn.cpac_update_clone_id=function(){var e=n(this),i=e.attr("data-column-name"),t=e.find("input, select, label");n(t).each(function(e,t){n(t).attr("name")&&n(t).attr("name",n(t).attr("name").replace("columns["+i+"]","columns["+incremental_column_name+"]")),n(t).attr("id")&&n(t).attr("id",n(t).attr("id").replace("-"+i+"-","-"+incremental_column_name+"-"))}),e.attr("data-column-name",incremental_column_name),incremental_column_name++},n(document).bind("column_init column_change column_add",function(e,i){var t=n(i).closest(".ac-boxes").hasClass("disabled");t||(n(i).cpac_bind_column_addon_events(),n(i).cpac_bind_indicator_events())}),n.fn.cpac_bind_column_addon_events=function(){var e=n(this),i=e.find("[data-trigger] label");i.on("click",function(){var i=n(this).closest("td.input").data("trigger"),t=n("input",this).val(),c=e.find('[data-indicator-id="'+i+'"]').removeClass("on");"on"==t&&c.addClass("on");var a=e.find('[data-handle="'+i+'"]').addClass("hide");"on"==t&&a.removeClass("hide")}),e.find("[data-trigger]").each(function(){var i=n(this).data("trigger"),t=e.find('[data-handle="'+i+'"]').addClass("hide");"on"==n("input:checked",this).val()&&t.removeClass("hide")})},n.fn.cpac_bind_indicator_events=function(){var e=n(this),i=e.find(".ac-column-header [data-indicator-toggle]");i.each(function(){var i=n(this),t=n(this).data("setting"),c=e.find(".ac-column-setting[data-setting="+t+"]"),a=c.find(".col-input:first .ac-setting-input:first input[type=radio]");i.unbind("click").on("click",function(e){e.preventDefault(),i.toggleClass("on"),n(this).hasClass("on")?a.filter("[value=on]").prop("checked",!0).trigger("click").trigger("change"):a.filter("[value=off]").prop("checked",!0).trigger("click").trigger("change")}),a.on("change",function(){var n=a.filter(":checked").val();"on"==n?i.addClass("on"):i.removeClass("on")})})},n.fn.cpac_bind_ordering=function(){n(this).each(function(){n(this).hasClass("ui-sortable")?n(this).sortable("refresh"):n(this).sortable({items:".ac-column",handle:".column_sort"})})},n.fn.cpac_column_setting_image_size=function(){function e(n,e){"cpac-custom"==e.val()?n.find(".ac-column-setting").show():n.find(".ac-column-setting").hide()}n(this).each(function(){var i=n(this),t=n(this).find(".ac-setting-input select");e(i,t),t.on("change",function(){e(i,n(this))})})},n(document).on("init_settings",function(e,i){n(i).find(".ac-column-setting--image").cpac_column_setting_image_size()}),n.fn.column_width_slider=function(){var e=n(this).find(".ac-setting-input-width"),i=e.find(".description input"),t=e.find(".unit-select input"),c=t.filter(":checked").val(),a=i.val(),o=e.find(".width-slider"),l=n(this).find(".ac-column-header .ac-column-heading-setting--width");"%"==c&&a>100&&(a=100),i.val(a),o.slider({range:"min",min:0,max:"%"==c?100:500,value:a,slide:function(n,e){i.val(e.value),l.trigger("update"),i.trigger("validate")}})},n.fn.cpac_column_setting_width=function(){n(this).each(function(){var e=n(this).parents(".ac-column");e.column_width_slider();var i=e.find(".ac-column-header .ac-column-heading-setting--width");i.on("update",function(){var i=e.find(".ac-setting-input-width .description input").val(),t=e.find(".ac-setting-input-width .description .unit").text();i>0?n(this).text(i+t):n(this).text("")});var t=e.find(".ac-setting-input-width .unit-select label");t.on("click",function(){e.find("span.unit").text(n(this).find("input").val()),e.column_width_slider(),i.trigger("update")});var c=e.find(".ac-setting-input-width .description input").on("keyup",function(){e.column_width_slider(),n(this).trigger("validate"),i.trigger("update")}).on("validate",function(){var e=c.val(),i=n.trim(e);n.isNumeric(i)||(i=i.replace(/\D/g,"")),i.length>3&&(i=i.substring(0,3)),i<=0&&(i=""),i!==e&&c.val(i)})})},n.fn.cpac_column_sub_setting_toggle=function(e){function i(n,e){var i=e.filter(":checked").val(),c=n.find(t.subfield);t.value_show==i?c.show():c.hide()}var t=n.extend({value_show:"on",subfield:".ac-column-setting"},e);n(this).each(function(){var e=n(this),t=n(this).find('.ac-setting-input input[type="radio"]');i(e,t),t.on("change",function(){i(e,t)})})},n(document).on("init_settings",function(e,i){n(i).find(".ac-column-setting--width").cpac_column_setting_width(),n(i).find(".ac-column-setting--filter").cpac_column_sub_setting_toggle(),n(i).find(".ac-column-setting--sort").cpac_column_sub_setting_toggle(),n(i).find(".ac-column-setting--edit").cpac_column_sub_setting_toggle()}),n(document).bind("column_change",function(e,i){var t=n(i),c=t.find('select[data-label="update"]');if(0!==c.length){var a=t.find("input.ac-setting-input_label"),o=c.find("option:selected").text();a.val(o),a.trigger("change")}})}(jQuery);