function cpac_submit_form(n){var e=n(".sidebox a.submit, .column-footer a.submit");e.click(function(){var a=n(this),c=a.closest(".columns-container").addClass("saving"),t=c.find(".cpac-columns form").serialize(),i=c.find(".ajax-message");e.attr("disabled","disabled"),c.find(".ajax-message").hide().removeClass("error updated"),n(".cpac_message").remove();var o=n.post(ajaxurl,{plugin_id:"cpac",action:"cpac_columns_update",data:t,_ajax_nonce:cpac._ajax_nonce,list_screen:c.data("type")},function(n){n&&(n.success?(i.addClass("updated").find("p").html(n.data),i.slideDown(),c.addClass("stored")):n.data&&(i.addClass(n.data.type).find("p").html(n.data.message),i.slideDown()))},"json");o.fail(function(n){}),o.always(function(){e.removeAttr("disabled","disabled"),c.removeClass("saving")}),n(document).trigger("cac_update",c)})}function cpac_add_column(n){n(".add_column").click(function(e){e.preventDefault();var a=n("#add-new-column-template").find(".cpac-column").clone();a.cpac_update_clone_id(cpac.list_screen),a.addClass("opened").find(".column-form").slideDown(150,function(){n("html, body").animate({scrollTop:a.offset().top-58},300)}),n(".cpac-columns form").append(a),a.cpac_column_refresh(),n(document).trigger("column_add",a)})}function cpac_sidebar_feedback(n){var e=n(".sidebox#direct-feedback");e.find("#feedback-choice a.no").click(function(n){n.preventDefault(),e.find("#feedback-choice").slideUp(),e.find("#feedback-support").slideDown()}),e.find("#feedback-choice a.yes").click(function(n){n.preventDefault(),e.find("#feedback-choice").slideUp(),e.find("#feedback-rate").slideDown()})}function cpac_init(n){var e=n(".columns-container"),a=e.find(".cpac-boxes");if(a.hasClass("disabled"))a.find(".cpac-column").each(function(e,a){n(a).column_bind_toggle(),n(a).find("input, select").prop("disabled",!0)});else{var c=a.find(".cpac-columns");c.find(".cpac-column").each(function(e,a){n(a).column_bind_toggle(),n(a).column_bind_remove(),n(a).column_bind_clone(),n(a).cpac_bind_indicator_events()}),c.cpac_bind_ordering()}n(document).trigger("cac_menu_change",c),n(document).trigger("cac_model_ready",e.data("type"))}function cpac_menu(n){n("#ac_list_screen").on("change",function(){n(this).prop("disabled",!0).next(".spinner").css("display","inline-block"),n(".view-link").hide(),window.location=n(this).val()})}function cpac_reset_columns(n){var e=n(".columns-container");n("a[data-clear-columns]").on("click",function(){e.find(".cpac-column").each(function(){n(this).find(".remove-button").trigger("click")})})}var cpac,cpac_i18n;jQuery(document).ready(function(n){return 0!==n("#cpac").length&&(cpac_init(n),cpac_submit_form(n),cpac_reset_columns(n),cpac_menu(n),cpac_add_column(n),void cpac_sidebar_feedback(n))}),function(n){n.fn.column_bind_toggle=function(){var e=n(this),a=e.closest("cpac-boxes").hasClass("disabled");e.find("td.column_type a, td.column_edit, td.column_label a.toggle, td.column_label .edit-button, td.column_label .close-button, tr.column_action .close-button").click(function(c){c.preventDefault(),e.toggleClass("opened").find(".column-form").slideToggle(150),a||(e.hasClass("events-binded")||e.column_bind_events(),e.addClass("events-binded"),n(document).trigger("column_init",e))})},n.fn.column_bind_remove=function(){n(this).find(".remove-button").click(function(e){n(this).closest(".cpac-column").column_remove(),e.preventDefault()})},n.fn.column_bind_clone=function(){n(this).find(".clone-button").click(function(e){e.preventDefault();var a=n(this).closest(".cpac-column"),c=a.column_clone();"undefined"!=typeof c&&c.removeClass("loading").hide().slideDown()})},n.fn.cpac_column_refresh=function(){var e=n(this),a=e.find(".column-type select"),c=n(this).closest(".columns-container"),t=n(this).find("input.column-name").val();e.addClass("loading"),a.prop("disabled",1);var i=n.post(ajaxurl,{plugin_id:"cpac",action:"cpac_column_refresh",_ajax_nonce:cpac._ajax_nonce,column:t,formdata:n(this).parents("form").serialize(),list_screen:c.data("type")},function(a){if(a){var c=n("<div>"+a.data+"</div>").children();e.replaceWith(c),e=c,e.column_bind_toggle(),e.column_bind_remove(),e.column_bind_clone(),e.column_bind_events(),e.addClass("opened").find(".column-form").show(),n(document).trigger("column_change",e)}},"json");i.fail(function(n){var a=e.closest(".columns-container").find(".ajax-message");a.addClass("error").find("p").html(cpac_i18n.error),a.slideDown(),e.slideUp(function(){e.remove()}),console.log("responseText: "+n.responseText)}),i.always(function(){e.removeClass("loading"),a.prop("disabled",!1)})},n.fn.column_bind_events=function(){var e=n(this),a=e.closest(".columns-container "),c=a.attr("data-type"),t=e.find(".column-type select option:selected").val();e.find(".column-type select").change(function(){var i=n("optgroup",this).children(":selected"),o=i.val(),l=n(this).next(".msg").hide(),d=n(this),s=[];a.find(".cpac-column[data-original=1]").each(function(){s.push(n(this).data("type"))}),e.addClass("loading"),n.ajax({url:ajaxurl,method:"post",dataType:"json",data:{plugin_id:"cpac",action:"cpac_column_select",original_columns:s,_ajax_nonce:cpac._ajax_nonce,type:o,list_screen:c}}).done(function(a){if(a)if(a.success){var c=e.closest(".cpac-column"),i=n("<div>"+a.data+"</div>").children();c.replaceWith(i),c=i,c.column_bind_toggle(),c.column_bind_remove(),c.column_bind_clone(),c.column_bind_events(),c.addClass("opened").find(".column-form").show(),c.find("*[data-refresh=1]").length>0&&c.cpac_column_refresh(),n(document).trigger("column_change",c)}else a.data&&"message"===a.data.type&&(l.html(a.data.error).show(),d.find("option").removeAttr("selected"),d.find('option[value="'+t+'"]').attr("selected","selected"))}).always(function(){e.removeClass("loading")})}),e.find(".column-form .column-label .input input").bind("keyup change",function(){var e=n(this).val();n(this).closest(".cpac-column").find("td.column_label .inner > a.toggle").text(e)}),e.column_width_slider();var i=e.find(".column-meta span.width");i.on("update",function(){var a=e.find("input.width").val(),c=e.find("input.unit").filter(":checked").val();a>0?n(this).text(a+c):n(this).text("")});var o=e.find(".column-width .unit-select label");o.on("click",function(){e.find("span.unit").text(n(this).find("input").val()),e.column_width_slider(),i.trigger("update")});var l=e.find("input.width").on("keyup",function(){e.column_width_slider(),n(this).trigger("validate"),i.trigger("update")}).on("validate",function(){var e=l.val(),a=n.trim(e);n.isNumeric(a)||(a=a.replace(/\D/g,"")),a.length>3&&(a=a.substring(0,3)),a<=0&&(a=""),a!==e&&l.val(a)});e.find(".column-image_size select").change(function(){var e=n(this).closest(".cpac-column").find(".column-image_size_w, .column-image_size_h").addClass("hide");"cpac-custom"===this.value&&e.removeClass("hide")}),e.find(".column-form .label label .label, .column-form .label .info").hover(function(){n(this).parents(".label").find("p.description").show()},function(){n(this).parents(".label").find("p.description").hide()}),e.find('[data-refresh="1"] select').change(function(){e.cpac_column_refresh()})},n.fn.column_remove=function(){n(this).addClass("deleting").animate({opacity:0,height:0},350,function(){n(this).remove()})},n.fn.column_width_slider=function(){var e=n(this).find(".column-width"),a=e.find("input.width"),c=e.find("input.unit"),t=c.filter(":checked").val(),i=a.val(),o=e.find(".width-slider"),l=n(this).find(".column-meta span.width");"%"==t&&i>100&&(i=100),a.val(i),o.slider({range:"min",min:0,max:"%"==t?100:500,value:i,slide:function(n,e){a.val(e.value),l.trigger("update"),a.trigger("validate")}})},n.fn.column_clone=function(){var e=n(this).closest(".columns-container"),a=n(this),c=n(this).closest("cpac-columns");if("undefined"==typeof a.attr("data-clone")){var t=cpac_i18n.clone.replace("%s","<strong>"+a.find(".column_label .toggle").text()+"</strong>");return a.addClass("opened").find(".column-form").slideDown(150),void a.find(".msg").html(t).show()}var i=n(this).clone();return i.cpac_update_clone_id(e.attr("data-type")),n(this).after(i),i.column_bind_toggle(),i.column_bind_remove(),i.column_bind_clone(),i.column_bind_events(),c.cpac_bind_ordering(),n(document).trigger("column_add",i),i},n.fn.cpac_update_clone_id=function(e){var a=n(this),c=a.attr("data-type"),t=n('.columns-container[data-type="'+e+'"]').find(".cpac-columns"),i=n(t).find('*[data-type="'+c+'"]').not(a),o=n.map(i,function(e){return n(e).attr("data-clone")?parseInt(n(e).attr("data-clone"),10):0});o.sort();for(var l=Math.max.apply(null,o)+1,d=0;d<=l&&-1!==n.inArray(d,o);d++);var s=a.attr("data-clone"),r="";s&&(r="-"+s),a.attr("data-clone",d),a.find("input.clone").val(d),a.find("input.column-name").val(c+"-"+d);var u=a.find("input, select, label");n(u).each(function(e,a){var t=c+"-"+d;n(a).attr("name")&&n(a).attr("name",n(a).attr("name").replace("["+c+r+"]","["+t+"]")),n(a).attr("for")&&n(a).attr("for",n(a).attr("for").replace(c+r+"-",t+"-")),n(a).attr("id")&&n(a).attr("id",n(a).attr("id").replace(c+r+"-",t+"-"))})},n(document).bind("column_init column_change column_add",function(e,a){var c=n(a).closest(".cpac-boxes").hasClass("disabled");c||(n(a).cpac_bind_column_addon_events(),n(a).cpac_bind_indicator_events())}),n.fn.cpac_bind_column_addon_events=function(){var e=n(this),a=e.find("[data-trigger] label");a.on("click",function(){var a=n(this).closest("td.input").data("trigger"),c=n("input",this).val(),t=e.find('[data-indicator-id="'+a+'"]').removeClass("on");"on"==c&&t.addClass("on");var i=e.find('[data-handle="'+a+'"]').addClass("hide");"on"==c&&i.removeClass("hide")}),e.find("[data-trigger]").each(function(){var a=e.find('[data-handle="'+n(this).data("trigger")+'"]').addClass("hide");"on"==n("input:checked",this).val()&&a.removeClass("hide")})},n.fn.cpac_bind_indicator_events=function(){var e=n(this),a=e.find("[data-indicator-id]");a.unbind("click").click(function(){var a=n(this).data("indicator-id"),c=e.find('[data-trigger="'+a+'"] input');n(this).hasClass("on")?(n(this).removeClass("on").addClass("off"),c.filter("[value=off]").prop("checked",!0).trigger("click")):(n(this).removeClass("off").addClass("on"),c.filter("[value=on]").prop("checked",!0).trigger("click"))})},n.fn.cpac_bind_ordering=function(){n(this).each(function(){n(this).hasClass("ui-sortable")?n(this).sortable("refresh"):n(this).sortable({items:".cpac-column"})})}}(jQuery);