function cpac_submit_form(e){var n=e(".sidebox a.submit, .column-footer a.submit");n.click(function(){var a=e(this),c=a.closest(".columns-container").addClass("saving"),t=c.find(".cpac-columns form").serialize(),i=c.find(".ajax-message");n.attr("disabled","disabled"),c.find(".ajax-message").hide().removeClass("error updated"),e(".cpac_message").remove();var o=e.post(ajaxurl,{plugin_id:"cpac",action:"cpac_columns_update",data:t,_ajax_nonce:cpac._ajax_nonce,list_screen:c.data("type")},function(e){e&&(e.success?(i.addClass("updated").find("p").html(e.data),i.slideDown(),c.addClass("stored")):e.data&&(i.addClass(e.data.type).find("p").html(e.data.message),i.slideDown()))},"json");o.fail(function(e){}),o.always(function(){n.removeAttr("disabled","disabled"),c.removeClass("saving")}),e(document).trigger("cac_update",c)})}function cpac_add_column(e){e(".add_column").click(function(n){n.preventDefault();var a=e("#add-new-column-template").find(".cpac-column").clone();a.cpac_update_clone_id(cpac.list_screen),a.addClass("opened").find(".column-form").slideDown(150,function(){e("html, body").animate({scrollTop:a.offset().top-58},300)}),e(".cpac-columns form").append(a),a.cpac_column_refresh(),e(document).trigger("column_add",a)})}function cpac_sidebar_feedback(e){var n=e(".sidebox#direct-feedback");n.find("#feedback-choice a.no").click(function(e){e.preventDefault(),n.find("#feedback-choice").slideUp(),n.find("#feedback-support").slideDown()}),n.find("#feedback-choice a.yes").click(function(e){e.preventDefault(),n.find("#feedback-choice").slideUp(),n.find("#feedback-rate").slideDown()})}function cpac_init(e){var n=e(".columns-container"),a=n.find(".cpac-boxes");if(a.hasClass("disabled"))a.find(".cpac-column").each(function(n,a){e(a).column_bind_toggle(),e(a).find("input, select").prop("disabled",!0)});else{var c=a.find(".cpac-columns");c.find(".cpac-column").each(function(n,a){e(a).column_bind_toggle(),e(a).column_bind_remove(),e(a).column_bind_clone(),e(a).cpac_bind_indicator_events()}),c.cpac_bind_ordering()}e(document).trigger("cac_menu_change",c),e(document).trigger("cac_model_ready",n.data("type"))}function cpac_menu(e){e("#ac_list_screen").on("change",function(){e(this).prop("disabled",!0).next(".spinner").css("display","inline-block"),e(".view-link").hide(),window.location=e(this).val()})}function cpac_reset_columns(e){var n=e(".columns-container");e("a[data-clear-columns]").on("click",function(){n.find(".cpac-column").each(function(){e(this).find(".remove-button").trigger("click")})})}jQuery(document).ready(function(e){return 0!==e("#cpac").length&&(cpac_init(e),cpac_submit_form(e),cpac_reset_columns(e),cpac_menu(e),cpac_add_column(e),void cpac_sidebar_feedback(e))}),jQuery.fn.column_bind_toggle=function(){var e=jQuery(this),n=e.closest("cpac-boxes").hasClass("disabled");e.find("td.column_type a, td.column_edit, td.column_label a.toggle, td.column_label .edit-button, td.column_label .close-button, tr.column_action .close-button").click(function(a){a.preventDefault(),e.toggleClass("opened").find(".column-form").slideToggle(150),n||(e.hasClass("events-binded")||e.column_bind_events(),e.addClass("events-binded"),jQuery(document).trigger("column_init",e))})},jQuery.fn.column_bind_remove=function(){jQuery(this).find(".remove-button").click(function(e){jQuery(this).closest(".cpac-column").column_remove(),e.preventDefault()})},jQuery.fn.column_bind_clone=function(){jQuery(this).find(".clone-button").click(function(e){e.preventDefault();var n=jQuery(this).closest(".cpac-column"),a=n.column_clone();"undefined"!=typeof a&&a.removeClass("loading").hide().slideDown()})},jQuery.fn.cpac_column_refresh=function(){var e=jQuery(this),n=e.find(".column-type select"),a=jQuery(this).closest(".columns-container"),c=jQuery(this).find("input.column-name").val();e.addClass("loading"),n.prop("disabled",1);var t=jQuery.post(ajaxurl,{plugin_id:"cpac",action:"cpac_column_refresh",_ajax_nonce:cpac._ajax_nonce,column:c,formdata:jQuery(this).parents("form").serialize(),list_screen:a.data("type")},function(n){if(n){var a=jQuery("<div>"+n.data+"</div>").children();e.replaceWith(a),e=a,e.column_bind_toggle(),e.column_bind_remove(),e.column_bind_clone(),e.column_bind_events(),e.addClass("opened").find(".column-form").show(),jQuery(document).trigger("column_change",e)}},"json");t.fail(function(n){var a=e.closest(".columns-container").find(".ajax-message");a.addClass("error").find("p").html(cpac_i18n.error),a.slideDown(),e.slideUp(function(){e.remove()}),console.log("responseText: "+n.responseText)}),t.always(function(){e.removeClass("loading"),n.prop("disabled",!1)})},jQuery.fn.column_bind_events=function(){var e=jQuery(this),n=e.closest(".columns-container "),a=n.attr("data-type");e.find(".column-type select option:selected").val();e.find(".column-type select").change(function(){var n=jQuery("optgroup",this).children(":selected"),c=n.val(),t=(n.text(),jQuery(this).next(".msg").hide());jQuery.post(ajaxurl,{plugin_id:"cpac",action:"cpac_column_select",_ajax_nonce:cpac._ajax_nonce,type:c,list_screen:a},function(n){if(n)if(n.success){var a=e.closest(".cpac-column");console.log(a);var c=jQuery("<div>"+n.data+"</div>").children();a.replaceWith(c),a=c,a.column_bind_toggle(),a.column_bind_remove(),a.column_bind_clone(),a.column_bind_events(),a.addClass("opened").find(".column-form").show(),jQuery(document).trigger("column_change",a)}else n.data&&"message"===n.data.type&&t.html(n.data.error).show()},"json");return}),e.find(".column-form .column-label .input input").bind("keyup change",function(){var e=jQuery(this).val();jQuery(this).closest(".cpac-column").find("td.column_label .inner > a.toggle").text(e)}),e.column_width_slider();var c=e.find(".column-meta span.width");c.on("update",function(){var n=e.find("input.width").val(),a=e.find("input.unit").filter(":checked").val();n>0?jQuery(this).text(n+a):jQuery(this).text("")});var t=e.find(".column-width .unit-select label");t.on("click",function(){e.find("span.unit").text(jQuery(this).find("input").val()),e.column_width_slider(),c.trigger("update")});var i=e.find("input.width").on("keyup",function(){e.column_width_slider(),jQuery(this).trigger("validate"),c.trigger("update")}).on("validate",function(){var e=i.val(),n=jQuery.trim(e);jQuery.isNumeric(n)||(n=n.replace(/\D/g,"")),n.length>3&&(n=n.substring(0,3)),n<=0&&(n=""),n!==e&&i.val(n)});e.find(".column-image_size select").change(function(){var e=jQuery(this).closest(".cpac-column").find(".column-image_size_w, .column-image_size_h").addClass("hide");"cpac-custom"===this.value&&e.removeClass("hide")}),e.find(".column-form .label label .label, .column-form .label .info").hover(function(){jQuery(this).parents(".label").find("p.description").show()},function(){jQuery(this).parents(".label").find("p.description").hide()}),e.find('[data-refresh="1"] select').change(function(){e.cpac_column_refresh()})},jQuery.fn.column_remove=function(){jQuery(this).addClass("deleting").animate({opacity:0,height:0},350,function(){jQuery(this).remove()})},jQuery.fn.column_width_slider=function(){var e=jQuery(this).find(".column-width"),n=e.find("input.width"),a=e.find("input.unit"),c=a.filter(":checked").val(),t=n.val(),i=e.find(".width-slider"),o=jQuery(this).find(".column-meta span.width");"%"==c&&t>100&&(t=100),n.val(t),i.slider({range:"min",min:0,max:"%"==c?100:500,value:t,slide:function(e,a){n.val(a.value),o.trigger("update"),n.trigger("validate")}})},jQuery.fn.column_clone=function(){var e=jQuery(this).closest(".columns-container"),n=jQuery(this),a=jQuery(this).closest("cpac-columns");if("undefined"==typeof n.attr("data-clone")){var c=cpac_i18n.clone.replace("%s","<strong>"+n.find(".column_label .toggle").text()+"</strong>");return n.addClass("opened").find(".column-form").slideDown(150),void n.find(".msg").html(c).show()}var t=jQuery(this).clone();return t.cpac_update_clone_id(e.attr("data-type")),jQuery(this).after(t),t.column_bind_toggle(),t.column_bind_remove(),t.column_bind_clone(),t.column_bind_events(),a.cpac_bind_ordering(),jQuery(document).trigger("column_add",t),t},jQuery.fn.cpac_update_clone_id=function(e){var n=jQuery(this),a=n.attr("data-type"),c=jQuery('.columns-container[data-type="'+e+'"]').find(".cpac-columns"),t=jQuery(c).find('*[data-type="'+a+'"]').not(n),i=jQuery.map(t,function(e){return jQuery(e).attr("data-clone")?parseInt(jQuery(e).attr("data-clone"),10):0});i.sort();for(var o=Math.max.apply(null,i)+1,l=0;l<=o&&-1!==jQuery.inArray(l,i);l++);var d=n.attr("data-clone"),r="";d&&(r="-"+d),n.attr("data-clone",l),n.find("input.clone").val(l),n.find("input.column-name").val(a+"-"+l);var u=n.find("input, select, label");jQuery(u).each(function(e,n){var c=a+"-"+l;jQuery(n).attr("name")&&jQuery(n).attr("name",jQuery(n).attr("name").replace("["+a+r+"]","["+c+"]")),jQuery(n).attr("for")&&jQuery(n).attr("for",jQuery(n).attr("for").replace(a+r+"-",c+"-")),jQuery(n).attr("id")&&jQuery(n).attr("id",jQuery(n).attr("id").replace(a+r+"-",c+"-"))})},jQuery.fn.cpac_bind_ordering=function(){jQuery(this).each(function(){jQuery(this).hasClass("ui-sortable")?jQuery(this).sortable("refresh"):jQuery(this).sortable({items:".cpac-column"})})},jQuery(document).bind("column_init column_change column_add",function(e,n){var a=jQuery(n).closest(".cpac-boxes").hasClass("disabled");a||(jQuery(n).cpac_bind_column_addon_events(),jQuery(n).cpac_bind_indicator_events())}),jQuery.fn.cpac_bind_column_addon_events=function(){var e=jQuery(this),n=e.find("[data-trigger] label");n.on("click",function(){var n=jQuery(this).closest("td.input").data("trigger"),a=jQuery("input",this).val(),c=e.find('[data-indicator-id="'+n+'"]').removeClass("on");"on"==a&&c.addClass("on");var t=e.find('[data-handle="'+n+'"]').addClass("hide");"on"==a&&t.removeClass("hide")}),e.find("[data-trigger]").each(function(){var n=e.find('[data-handle="'+jQuery(this).data("trigger")+'"]').addClass("hide");"on"==jQuery("input:checked",this).val()&&n.removeClass("hide")})},jQuery.fn.cpac_bind_indicator_events=function(){var e=jQuery(this),n=e.find("[data-indicator-id]");n.unbind("click").click(function(){var n=jQuery(this).data("indicator-id"),a=e.find('[data-trigger="'+n+'"] input');jQuery(this).hasClass("on")?(jQuery(this).removeClass("on").addClass("off"),a.filter("[value=off]").prop("checked",!0).trigger("click")):(jQuery(this).removeClass("off").addClass("on"),a.filter("[value=on]").prop("checked",!0).trigger("click"))})};